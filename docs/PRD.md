# 產品需求文件 (Product Requirements Document) v2.0

## 專案名稱： Taipei Lens — 台北都市韌性規劃平台

### 1\. 總覽 (Overview)

本文件旨在定義「台北都市韌性規劃平台 (Taipei Lens)」的核心功能與設計理念。Taipei Lens 是一個以都市規劃者為中心、以「行動導向」為設計哲學的互動式決策支援工具。平台旨在打破傳統風險評估的數據壁壘，將都市規劃師的工作流程——特別是**都市更新**中的\*\*「整建」**與**「重建」\*\*決策——直接融入產品核心。

透過整合 NASA 地球觀測數據與台北在地資料，Taipei Lens 賦予規劃師能力，使其可以**自定義風險評估模型**，動態模擬不同政策優先級下的情境，並在地圖上直觀地識別出最需要投入資源的「超級熱區」，從而制定更具科學依據、更公平、更具韌性的都市發展策略。**此外，平台將引入以大型語言模型驅動的 AI Co-pilot，讓使用者能透過自然語言直接查詢與探索地理空間數據，實現更深層次的互動式洞察。**

### 2\. 問題陳述 (Problem Statement)

台北市作為一個高密度發展的現代都會，其都市更新的推動面臨著三大相互交織的嚴峻挑戰：

1. **結構安全風險 (Structural Safety Risk):** 台北位於地震活躍帶，然而市內存在大量依循舊有抗震規範興建的老舊建築。這些潛在的脆弱結構在未來強震中，對市民的生命財產構成直接且嚴重的威脅。

2. **氣候變遷風險 (Climate Change Risk):** 盆地地形使台北的都市熱島效應尤為顯著。在全球暖化趨勢下，極端高溫事件頻率增加，不僅加劇能源消耗，更對市民健康，特別是居住在通風不良、缺乏綠地的弱勢族群，構成致命衝擊。

3. **社會脆弱性風險 (Social Vulnerability Risk):** 人口高齡化、獨居長者比例攀升以及貧富差距，使得社會中存在特定脆弱群體。這些群體在災害來臨時，往往缺乏足夠的應變與恢復能力，但其空間分佈資訊卻常與物理環境風險脫鉤。

面對這些複合式風險，都市規劃者在推動都市更新、分配有限資源時，極度缺乏一個能整合上述挑戰的決策工具。他們需要一個能**主動定義、量化、並模擬**在不同政策側重下（例如優先抗震、優先降溫或優先照顧弱勢）都市更新急迫性的動態平台，以科學化地說服利害關係人，並確保資源被投放到最需要的地方。

### 3\. 目標使用者 (Target Audience)

**核心使用者：** 台北市政府都市發展局、都市更新處、防災應變單位的規劃師與政策制定者。

**使用者畫像 (Persona):**

- **姓名：** 陳規劃師

- **背景：** 負責台北市都市更新計畫的專案經理，需在年度預算會議上提出未來一年的「優先整建區域」與「潛力重建地區」的規劃草案。

- **痛點：**

   - **如何說服利害關係人？** 「我怎麼用數據證明，信義區 A 里比大安區 B 里的老舊公寓，更需要進行耐震補強的補助？」

   - **如何應對變動的需求？** 「如果市長的施政方針從『防災優先』轉向『降溫綠化』，我需要花一週時間重新整理資料，才能提出新的計畫區域。」

   - **如何找到潛力區域？** 「除了那些媒體報導的危老建築，還有哪些被忽略的、但綜合風險很高的社區，值得我們主動介入規劃？」

   - **如何進行探索式查詢？** 「現有的儀表板能回答我預設的問題，但如果我想問一個非常具體、跨越多個圖層的問題，例如『找出信義區所有屋齡超過 40 年，且鄰近 500 公尺內沒有公園的住宅區』，我還是得手動交叉比對資料，非常耗時。」

- **期望：** 陳規劃師希望能有一個專業工具，讓他可以：

   1. **建立自己的評估模型：** 透過調整不同風險因子的權重，來反映當前的政策方向。

   2. **一鍵生成優先級地圖：** 輸入模型參數後，能立即在地圖上看到結果，並能調整閥值篩選出最關鍵的區域。

   3. **直接用說的問問題：** 希望能像跟助理說話一樣，直接輸入問題，系統就能立即在地圖上視覺化呈現結果。

### 4\. 功能需求 (Functional Requirements)

#### **4\.1 核心介面：互動式 3D 地圖儀表板**

- **FR-1.1 (地圖基底):** 採用高解析度的台北市 3D 建築地圖，作為所有分析結果的視覺化畫布。

- **FR-1.2 (地圖互動):** 提供流暢的地圖操作體驗，包含平移 (Pan)、縮放 (Zoom) 與旋轉視角 (Rotate/Pitch)。

- **FR-1.3 (資訊探查):** 滑鼠懸停在任一「最小統計區域」或建築物上時，能彈出視窗顯示其基礎屬性資訊。

   - **基礎資訊顯示:** Popup 視窗會顯示建築物的基本屬性，如面積、樓高等數值資訊。

   - **Fragility Curve 視覺化:** 在基礎資訊下方，顯示一個小型的 Fragility Curve（易損性曲線）二維圖表，用於說明該建築物的耐震能力。

      - **橫軸 (X軸):** 地震規模 (Magnitude) 或地震加速度 (PGA)

      - **縱軸 (Y軸):** 損失程度 (Damage Probability)，範圍從 0 到 1 或 0% 到 100%

      - **曲線類型:** 顯示該建築物在不同地震強度下的預期損壞機率曲線

      - **圖表尺寸:** 小型嵌入式圖表，建議寬度 180-220px，高度 120-150px，以適合 Popup 視窗

#### **4\.2 核心功能：規劃師工具箱 (Planner's Toolbox)**

位於介面左側的懸浮式、可收合側邊欄，是平台的核心。其結構設計完全貼合都市更新的規劃流程。

- **FR-2.1 (整體結構):**

   - **手風琴式選單:** 工具箱分為三大可獨立展開/收合的區塊：`1. 原始數據圖層`、`2. 整建分析模組`、`3. 重建分析模組`。

- **FR-2.2 (原始數據圖層 - Data Layers):**

   - **功能:** 提供基礎數據的視覺化開關，供規劃師進行初步的環境探查。

   - **UI 元件:** 一系列帶有單選按鈕 (Radio Button) 的圖層列表。

   - **互斥顯示:** 為避免多個圖層疊加造成視覺混亂，**一次只能勾選一個圖層**。當使用者選擇新圖層時，先前選中的圖層會自動取消勾選。再次點擊已選中的圖層可以取消選擇。

   - **需求:** 至少包含：地表溫度、綠覆率、建築屋齡、人口密度、社會脆弱性指標等圖層。

- **FR-2.3 (核心分析流程 - General Workflow):**

   - **適用範圍:** `整建分析模組`與`重建分析模組`下的所有子模組均遵循此流程。

   - **步驟 1 - 參數設定:** 使用者在展開的模組介面中，透過「互動式公式」設定各因子的權重，並透過「數值輸入框」設定觸發高亮的閥值。

   - **步驟 2 - 觸發運算:** 使用者點擊模組下方的 **\[執行分析\]** 按鈕。

   - **步驟 3 - 結果呈現:** 系統在後端進行計算，完成後在地圖上高亮顯示所有綜合分數**大於等於**設定閥值的「最小統計區域」。

   - **步驟 4 - 結果重置:** 提供 **\[清除結果\]** 按鈕，用以清除地圖上的高亮圖層。

#### **4\.3 整建分析模組 (Renovation Analysis Module)**

專注於現有都市結構的改善與補強，旨在幫助規劃師決定「錢要花在哪個刀口上」。

**子模組 3.1：道路綠化優先級分析**

- **目標:** 識別最需要透過植樹進行降溫及環境改善的區域。

- **互動式公式 UI (FR-3.1.1):**

   - **公式展示:** `優先級分數 = ( 因子A × 權重A ) + ( 因子B × 權重B ) + ...`

   - **可調因子與權重:**

      - `地表溫度`：權重 \[數值輸入框\]，預設 0.4

      - `(1 - 綠覆率)`：權重 \[數值輸入框\]，預設 0.3

      - `人口密度`：權重 \[數值輸入框\]，預設 0.3

   - **權重約束:** 所有權重數值的總和必須等於 1，當使用者修改任一權重時，系統可提示或自動平衡其他值。

   - **閥值設定:** `高亮分數 >=` \[數值輸入框\]，範圍 0-1，預設 0.8

   - **科學方法提示 (`?`):** 解釋為何選擇這些因子，以及「1 - 綠覆率」代表綠化不足的程度。

**子模組 3.2：建築耐震補強優先級分析**

- **目標:** 識別地震損壞風險最高，最需優先進行結構補強的區域。

- **互動式公式 UI (FR-3.2.1):**

   - **公式展示:** `優先級分數 = ( 因子A × 權重A ) + ( 因子B × 權重B ) + ...`

   - **可調因子與權重:**

      - `建築平均屋齡`：權重 \[數值輸入框\]，預設 0.5

      - `結構脆弱度`：權重 \[數值輸入框\]，預設 0.3

      - `土壤液化潛勢`：權重 \[數值輸入框\]，預設 0.2

   - **閥值設定:** `高亮分數 >=` \[數值輸入框\]，範圍 0-1，預設 0.75

   - **科學方法提示 (`?`):** 解釋結構脆弱度如何評估（如基於結構類型），以及各因子的數據來源。

#### **4\.4 重建分析模組 (Reconstruction Analysis Module)**

著眼於大規模的都市更新與空間再造，輔助規劃師進行更宏觀的區域規劃。

**子模組 4.1：公園新闢選址潛力分析**

- **目標:** 找出最缺乏公園綠地且潛在需求最高的區域。

- **互動式公式 UI (FR-4.1.1):**

   - **公式展示:** `潛力分數 = ( 因子A × 權重A ) + ( 因子B × 權重B ) + ...`

   - **可調因子與權重:**

      - `(1 - 綠地服務涵蓋率)`：權重 \[數值輸入框\]，預設 0.5

      - `人口密度`：權重 \[數值輸入框\]，預設 0.3

      - `社會脆弱性指標`：權重 \[數值輸入框\]，預設 0.2

   - **閥值設定:** `高亮分數 >=` \[數值輸入框\]，範圍 0-1，預設 0.8

   - **科學方法提示 (`?`):** 解釋「綠地服務涵蓋率」的計算方式（如 500 公尺步行範圍內的公園面積）。

**子模組 4.2：都市更新急迫性分析**

- **目標:** 綜合評估多重風險，識別最需進行大規模重建的核心區域。

- **互動式公式 UI (FR-4.2.1):**

   - **公式展示:** `急迫性分數 = ( 因子A × 權重A ) + ( 因子B × 權重B ) + ...`

   - **可調因子與權重:**

      - `地震綜合風險`：權重 \[數值輸入框\]，預設 0.4 (此因子可參考「建築耐震補強」模組的分析結果)

      - `都市熱島衝擊`：權重 \[數值輸入框\]，預設 0.3

      - `(1 - 土地利用效率)`：權重 \[數值輸入框\]，預設 0.3

   - **閥值設定:** `高亮分數 >=` \[數值輸入框\]，範圍 0-1，預設 0.85

   - **科學方法提示 (`?`):** 解釋「土地利用效率」的代理指標（如平均容積率），以及各綜合風險因子的構成。

#### **4\.5 AI Co-pilot：自然語言數據查詢介面**

位於介面底部中央的固定式對話框，作為使用者與平台數據直接互動的入口。

- **FR-5.1 (介面設計):**

   - **輸入框:** 介面包含一個文字輸入框，內部有提示文字，如「詢問關於台北的任何事... (Ask something about Taipei...)」。

   - **觸發方式:** 使用者輸入問題後，可透過按下 Enter 鍵或點擊發送按鈕觸發查詢。

- **FR-5.2 (查詢能力與回應類型):**

   - **一般性知識問答:** 使用者可以詢問與台北相關的基本知識（例如「台北 101 有多高？」、「大安森林公園的歷史？」），由後端串接的 LLM 直接回答，回應以純文字形式呈現在對話框中。

   - **空間數據查詢:** 這是核心功能。使用者可以對平台內的數據圖層提出具體問題。系統需能解析自然語言，並轉換為對數據的查詢。

      - **範例 1 (篩選查詢):** 「幫我找出所有地震損失率在八級時低於 30% 的建築物。」

      - **範例 2 (區域統計查詢):** 「哪一個區的獨居老人比例最高？」

      - **範例 3 (複合條件查詢):** 「顯示地表溫度高於 35 度，且綠覆率低於 20% 的區域。」

   - **分析型問答:** 探索性的問題，需要後端進行簡單的即時計算。

      - **範例 1 (排序):** 「列出台北市人口密度最高的前五個里。」

      - **範例 2 (比較):** 「比較信義區與中正區的平均建築屋齡。」

- **FR-5.3 (結果呈現):**

   - **文字回應:** 對於一般性知識或統計型問題，在對話框中提供簡潔的文字答案。

   - **地圖互動:** 對於所有**空間數據查詢**，回應必須與地圖連動。符合條件的「最小統計區域」或建築物應在地圖上高亮顯示，作為查詢結果的視覺化呈現。

   - **清除機制:** 提供一個「清除查詢結果」的按鈕，讓使用者可以清除地圖上的高亮圖層，返回原始狀態。

### 5\. 數據與方法論

- **FR-6.1 (核心分析單元):** 本平台所有分析與視覺化均基於統一的地理網格——**「最小統計區域」**。所有原始數據皆預處理並彙整至此單元。

- **FR-6.2 (數據標準化):** 在進行任何加權計算前，所有因子的原始數據均採用\*\*「最大-最小標準化法 (Min-Max Normalization)」\*\*，將其數值縮放至 0 到 1 的區間內，以確保加權計算的公平性與可比較性。

- **FR-6.3 (數據來源):**

   - **NASA 數據:** ECOSTRESS/Landsat 地表溫度 (LST)。

   - **在地數據:** 台北市政府開放平台（建築使用執照、綠地圖資）、內政部戶政司（人口統計）、國家災害防救科技中心（土壤液化圖資）。

### 6\. 技術考量

- **前端框架：** React.js

- **地圖函式庫：** Mapbox GL JS

- **後端框架：** FastAPI (Python) - 用於處理數據API與潛在的複雜計算。

- **數據預處理:** 使用 GeoPandas、Python 等工具進行所有數據的標準化與空間對位，並生成供前端調用的靜態 GeoJSON 或 Vector Tiles。

- **大型語言模型 (LLM) 整合:** 透過 API 串接外部大型語言模型服務 (如 Google Gemini, OpenAI GPT 等)，用於自然語言理解 (NLU) 與生成查詢指令。

### 7\. 超出範圍 (Out of Scope for Hackathon)

- 使用者帳號系統與專案儲存功能。

- 公民參與或意見回饋機制。

- 除了台北市以外的地區。

- **AI Co-pilot 的多輪對話與上下文記憶功能。** (目前的設計為一次性的問答)

- **透過 AI Co-pilot 直接執行或修改「整建/重建分析模組」的權重與參數。** (AI 僅用於數據查詢，而非執行核心分析)